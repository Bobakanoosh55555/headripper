<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>RC Car Control Panel</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
</head>
<body>
  <h1>RC Car Control</h1>

  <div id="controls">
    <button class="key up" data-cmd="forward">↑</button>
    <button class="key left" data-cmd="left">←</button>
    <button class="key stop" data-cmd="stop">■</button>
    <button class="key right" data-cmd="right">→</button>
    <button class="key down" data-cmd="backward">↓</button>
  </div>

  <h2>Live Camera Feed</h2>
  <iframe id="video" src="https://tolerant-warthog-blindly.ngrok-free.app/?action=stream" width="640" height="480" frameborder="0"></iframe>

  <script>
    const ctrlURL = "https://chamois-strong-hookworm.ngrok-free.app/control/";
    const keyMap = {
      w: "forward",
      a: "left",
      s: "backward",
      d: "right",
      " ": "stop"
    };

    const buttonMap = {
      forward: document.querySelector(".key.up"),
      left: document.querySelector(".key.left"),
      right: document.querySelector(".key.right"),
      backward: document.querySelector(".key.down"),
      stop: document.querySelector(".key.stop")
    };

    function highlight(command) {
      Object.values(buttonMap).forEach(btn => btn.classList.remove("active"));
      if (buttonMap[command]) {
        buttonMap[command].classList.add("active");
      }
    }

    function send(cmd) {
      fetch(ctrlURL + cmd).then(() => console.log("Sent", cmd));
      highlight(cmd);
    }

    document.addEventListener("keydown", (e) => {
      const cmd = keyMap[e.key.toLowerCase()];
      if (cmd) send(cmd);
    });

    document.querySelectorAll(".key").forEach(btn => {
      btn.addEventListener("click", () => {
        const cmd = btn.dataset.cmd;
        send(cmd);
      });
    });
  </script>
</body>
</html>
